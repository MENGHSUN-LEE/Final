<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <style>
        body {
            font-family: sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f4f4f9;
            margin: 0;
            width: 100%;
        }

        #app-container {
            display: flex;
            flex-direction: column;
            width: 100%;
            max-width: 600px;
            min-height: 50vh;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
            margin: auto;
            transition: max-width 0.5s, min-height 0.5s, box-shadow 0.5s;
            background: white;
        }

        body:not(.no-nav) #app-container {
            max-width: 100%;
            /* ä½”æ»¿è¦–çª—å¯¬åº¦ */
            min-height: 100vh;
            /* ä½”æ»¿æ•´å€‹è¦–çª—é«˜åº¦ */
            box-shadow: none;
            /* ç§»é™¤å¡ç‰‡é™°å½±ï¼Œç‡Ÿé€ å…¨è¢å¹•æ‡‰ç”¨ç¨‹å¼æ„Ÿ */
        }

        body:not(.no-nav) #main {
            align-items: flex-start;
            /* è®“å…§å®¹å¾é ‚éƒ¨é–‹å§‹ */
            justify-content: flex-start;
            /* è®“å…§å®¹é å·¦é–‹å§‹ */
            padding: 0;
            /* ç§»é™¤å¤–å±¤ paddingï¼Œè®“ Tab å…§å®¹å€åŸŸè²¼é‚Š */
        }

        #tab-content {
            padding: 20px;
            /* é€™è£¡æ‰æ˜¯ Tab å…§å®¹çš„é‚Šè· */
            width: 100%;
            box-sizing: border-box;
            /* ç¢ºä¿åœ¨å…¨è¢å¹•æ¨¡å¼ä¸‹ä½”æ»¿å‰©é¤˜é«˜åº¦ (é¸ç”¨) */
            flex-grow: 1;
        }

        #main {
            display: flex;
            flex-grow: 1;
            justify-content: center;
            align-items: flex-start;
            width: 100%;
            padding: 20px;
            box-sizing: border-box;
        }

        /* æ–°å¢å°èˆªåˆ—æ¨£å¼ */
        #navbar {
            display: flex;
            justify-content: space-around;
            background-color: #343a40;
            padding: 10px 0;
            border-bottom: 3px solid #007bff;
        }

        #navbar .nav-link {
            display: none;
        }

        /* è¨ªå®¢æ¨¡å¼ (Guest): åªé¡¯ç¤º æœå°‹ */
        .tab-guest #tab-search {
            display: block;
        }

        /* æœƒå“¡æ¨¡å¼ (Member): é¡¯ç¤ºæ‰€æœ‰ Tab */
        .tab-member #tab-search,
        .tab-member #tab-edit,
        .tab-member #tab-custom {
            display: block;
        }


        .no-nav #navbar,
        .no-nav #tab-content {
            display: none;
        }

        /* åœ¨æ²’æœ‰å°èˆªåˆ—æ™‚ï¼Œä¸»å…§å®¹å€åŸŸéœ€è¦ç¨ä½”æ•´å€‹ #app-container */
        .no-nav #main {
            align-items: center;
            justify-content: center;
            height: 100%;
            padding: 20px;
            /* åœ¨é¦–é æ¨¡å¼ä¸‹ï¼Œç¢ºä¿å…§å®¹ä»ç„¶æœ‰ padding */
        }

        .nav-link {
            color: white;
            text-decoration: none;
            padding: 8px 15px;
            border-radius: 4px;
            transition: background-color 0.3s;
        }

        .nav-link.active,
        .nav-link:hover {
            background-color: #007bff;
        }

        .actions {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #startBtn {
            padding: 15px 40px !important;
            font-size: 20px;
            width: auto !important;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }

        .card {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        /* ... (å…¶ä»– CSS æ¨£å¼ä¿æŒä¸è®Š) ... */
    </style>
</head>

<body hx-ext="response-targets, remove-me" hx-target-error="#toast" hx-on::before-swap="doWrap(event)"
    class="tab-{{tabType}} {{#if tabType}}no-nav{{/if}}">

    <div id="app-container">
        <nav id="navbar">
            <a href="#search" id="tab-search" class="nav-link active" data-content-url="/search">ğŸ” æœå°‹</a>
            <a href="#edit" id="tab-edit" class="nav-link" data-content-url="/edit">âœï¸ ç·¨è¼¯</a>
            <a href="#custom" id="tab-custom" class="nav-link" data-content-url="/custom">ğŸ“Š è‡ªé¸åŠŸèƒ½</a>
        </nav>

        <main id="main">
            {{{body}}}
        </main>
    </div>

    <div id="toast"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const path = window.location.pathname;
            const body = document.body;

            // åˆ¤æ–·æ˜¯å¦ç‚ºæœƒå“¡/è¨ªå®¢ä¸»é é¢
            const isAppPage = path.startsWith('/app/');

            // ä¿®æ­£ no-nav é‚è¼¯ï¼šåªæœ‰é¦–é å’Œç™»å…¥é éœ€è¦ no-nav
            if (path === '/' || path === '/login') {
                body.classList.add('no-nav');
            } else {
                body.classList.remove('no-nav');
            }

            // è™•ç† Tab é»æ“Šäº‹ä»¶ (åƒ…åœ¨ /app é é¢éœ€è¦)
            if (isAppPage) {
                const tabs = document.querySelectorAll('#navbar .nav-link');

                // ... (Tab é»æ“Šå’Œåˆå§‹è¼‰å…¥é‚è¼¯ä¿æŒä¸è®Šï¼Œå®ƒæœƒé è¨­è¼‰å…¥ #tab-search) ...

                // --- Tab é»æ“Šé‚è¼¯ ---
                tabs.forEach(tab => {
                    // ... (Tab é»æ“Šé‚è¼¯ä¿æŒä¸è®Š) ...
                });

                // --- åˆå§‹è¼‰å…¥ Tab å…§å®¹ ---
                // æª¢æŸ¥å“ªäº› Tab æ˜¯å¯è¦‹çš„ï¼Œä¸¦é è¨­è¼‰å…¥ç¬¬ä¸€å€‹å¯è¦‹çš„ Tab
                let initialTab = document.querySelector('.tab-{{tabType}} .nav-link[style*="display: block"]');
                if (!initialTab) {
                    // å¦‚æœ CSS å°šæœªç”Ÿæ•ˆï¼Œé è¨­è¼‰å…¥ #tab-search
                    initialTab = document.querySelector('#tab-search');
                }

                if (initialTab) {
                    // è¨­å®š active ç‹€æ…‹
                    tabs.forEach(t => t.classList.remove('active'));
                    initialTab.classList.add('active');

                    const initialUrl = initialTab.getAttribute('data-content-url');
                    // ç¢ºä¿ htmx å·²è¼‰å…¥
                    if (htmx) {
                        htmx.ajax('GET', initialUrl, { target: '#tab-content', swap: 'innerHTML' });
                    }
                }
            }
        });
    </script>

    
</body>

</html>